# D338 Cloud Platform Solutions Azure Administrator AZ-104

## Tips

- **Azure for Students Starter**: access to free tier items only. cannot access non-free services.
- **Azure for Students**: $100 credit + free tier services. access to non-free services.
  - [Student portal pricing](https://www.microsoftazuresponsorships.com/Balance) // must be signed in.
- **Complete_D338_Notes_UPDATE.docx**: put critical info in **red**. I also separated each line with blue and black lettering to make it **easier to read** and added links to outside resources that helped me.
- **First Impressions**: the OA is focused on network infrastructure terminology and function. The AZ-104 certification test leans more toward building infrastructure with CLI & powershell,. While both are essential, it makes learning an already difficult test, more difficult.
- **Tutorials, Advice**
  - <https://www.reddit.com/r/WGU/comments/18i1uv8/wgu_d338_its_super_easy/>
  - <https://www.reddit.com/r/AzureCertification/comments/1colul0/passed_az104_my_experience_with_this_exam/>
  - <https://www.linkedin.com/pulse/passing-az-104-exam-everything-you-need-know-neeraj-kumar/>
  - <https://www.reddit.com/r/AzureCertification/comments/1crlfs5/passed_az104/>
    - Storage, Entra, and networking areas had tricky questions.
  - <https://www.reddit.com/r/AzureCertification/comments/1ctkwt0/passed_az_104/>
  - Search for each topic on Microsoft documentation and Microsoft learn to help study each area of the AZ-104 exam. Use search like this ms **docs + "Study topic"**.
  - <https://www.thomasmaurer.ch/2020/03/az-104-study-guide-azure-administrator/>
  - <https://www.reddit.com/r/AZURE/comments/164oe1q/passed_az104_yesterday_the_open_book_feature_is/>
  - <https://portal.tutorialsdojo.com/courses/az-104-microsoft-azure-administrator-practice-exams/>
  - <https://www.reddit.com/r/AzureCertification/comments/1dnd53n/passed_az104_by_the_skin_of_my_teeth/>
  - <https://www.reddit.com/r/AzureCertification/comments/1dn8l1s/az104_microsoft_learn/>
- **Videos**
  - <https://www.youtube.com/playlist?list=PLlVtbbG169nGlGPWs9xaLKT1KfwqREHbs>
  - <https://wgu.udemy.com/course/az-104-microsoft-azure-administrator-lab-exam-prep/>
  - <https://www.linkedin.com/learning/paths/prepare-for-the-microsoft-azure-administrator-az-104-certification-exam>
- **Flashcards**
  - <https://quizlet.com/791527803/az-104-flash-cards/?funnelUUID=f595251a-598c-4eff-8213-e64cb8286eb8>
  - <https://www.brainscape.com/subjects/az-104>
- **Notes**
  - <https://github.com/mischavandenburg/az-104-azure-administrator> // includes Anki cards.
  - <https://github.com/oliverbebber/AZ-104-Study-Notes/tree/main>
  - <https://gist.github.com/robsteriam/5cab2b6d4f759c12cb5a85d7d807050d>
- **Book**
  - <https://lrps.wgu.edu/provision/277282392> // must be signed in.
- **Course Chatter**
  - Make sure to know the difference between RBAC and Azure AD roles, and how they are used.
  - Know all the different "types" of things like AD license types, Load Balancer types, storage account types, etc... and what can/cannot be done with them.
  - Know about how policies and roles work together.
  - Know about the different types of backup, and how it's used. Know about containers and networking, and the different ways monitoring is done and used.
  - **Joshua S**
    - AZ-104. Prep for the actual certification and gauges knowledge on how-to and CLI commands, Powershell scripting etc.
    - The OA however will not, so spending time in a lab going through the how-to's and pouring over script and .csv examples in the book won't get me past the WGU exam but will come handy for the Microsoft Certification. Without a doubt, the Pluralsight videos and practice exams did very little to prepare for the OA.
    - have come to the conclusion that the OA is taken straight from the book and video links nor the AZ-104 practice exams in Pluralsight.
    - flashcards for memorization will help with Ports, Subscription levels, and specific concepts like Cloud vs On-Prem.
- **Microsoft**
  - 700 of 1000 to pass.
  - Hands-on experience is crucial in preparing for the AZ-104 exam.
  - [practice questions](https://learn.microsoft.com/en-us/credentials/certifications/exams/az-104/practice/assessment?assessment-type=practice&assessmentId=21&source=docs)
  - [Azure All Services](https://azure.microsoft.com/en-us/products/)
  - [AZ-104 Training](https://learn.microsoft.com/en-us/training/courses/az-104t00#course-syllabus)
  - [AZ-104 Overview](https://learn.microsoft.com/en-us/credentials/certifications/azure-administrator/?practice-assessment-type=certification)
  - [AZ-104 Study Guide](https://learn.microsoft.com/en-us/credentials/certifications/resources/study-guides/az-104)
  - [AZ-104 Labs](https://microsoftlearning.github.io/AZ-104-MicrosoftAzureAdministrator/)
  - [AZ-104 Exam Prep Videos](https://learn.microsoft.com/en-us/shows/exam-readiness-zone/preparing-for-az-104-manage-azure-identities-and-governance-1-of-5)
- **Exam Purpose**:
  - <https://learn.microsoft.com/en-us/credentials/certifications/resources/study-guides/az-104#skills-measured-as-of-october-26-2023>
  - **Weights**
    - Manage Azure identities and governance (15-20%)
    - Implement and manage storage (15-20%)
    - Deploy and manage Azure compute resources (20-25%)
    - Configure and manage virtual networking (25-30%)
    - Monitor and back up Azure resources (10-15%)
    - 120 minutes. 40-60 questions. passing is 700 out of 1000 points (70%). $165.

## Azure Cloud Shell

- **Cloud Shell**
  - browser based(access anywhere) cli for bash, powershell.
  - cloud storage provides
  - upload scripts and store on cloud for access anywhere.
  - **Rules**
    - session last **20 minutes**. Not for long running scripts, session will **end without warning**.
    - no 'sudo' or admin permission changes.
    - no non-supported tool installs.
    - no multiple region storage.
    - no multiple sessions.

## Azure Resources, Resource Groups and Resource Manager

- **resource**
  - a resource in Azure is a **single service instance**(VM, VNET, Storage, any Azure Service...).
  - can only **belong** to **one resource group**.
  - does **not** have to belong to a resource group(can belong to tenant, management group, subscription...).
- **Resource Limits**
  - track usage against limits and plan for future needs.
  - limits shown are for you **subscription**.
  - all resources have 'maximum' limits threshold that you can't increase.
  - ![resource limits](img/resource_limits.PNG)
- **resource group**
  - container that holds related resources(logical collection).
  - you can **delete** a resource group with the **Azure Portal, Azure PowerShell, the Azure CLI**, or the **REST API**.
  - **Rules**
    - **each resource can only exist in one resource group**.
    - resource groups **cannot** be **nested**.
    - resource group **cannot** be **renamed**.
    - can have many different type(services) and **regions**.
    - you can move resources to other resource groups. when **moving resources** from one group to another, you **can't add, update, or delete resources** in the resource groups until the move completes(the underlying **service** will continue to function).
      - the resource group you move resource into must have enough resource quota. e.g. move VM and vCPU quota is at max limit.
    - all resources share the same lifecycle. e.g. you deploy, update, delete them together.
    - a resource **can interact** with resources in other resource groups.
    - **RBAC(role based access control)** can be **assigned** to resource groups.
    - because a resource group contains metadata about resources, for **compliance reasons(government, sovereign states)**, you must provide a **location** of resource group.
  - ![az scope](img/az-scopes-billing.png)

```powershell
# remove resource group.
Remove-AzResourceGroup -Name "YourResourceGroupName"
```

- **Azure Resource Manager (ARM)**
  - deploy, manage, monitor, security, auditing, tagging, authentication (vm, database, third-party...) as a group.
  - **Benefits**
    - reusable templates allow easy deployment.
    - handle resources as a group instead of individually.
    - tag resources.
  - ![resource management](img/resource_management.PNG)
- **declarative syntax**
  - declarative programming. **what you want, not how to do it**.
  - Syntax that lets you state "Here is what I intend to create" without having to write the sequence of programming commands to create it. The Resource Manager template is an example of declarative syntax. In the file, you define the properties for the infrastructure to deploy to Azure.
- **Resource Manager locks**
  - prevent accidental deletion of resources, even if you have delete permissions.
  - only the **Owner** and **User Access Administrator** roles can create or delete management locks.
  - child resources inherit **Locks**.
  - **Read-Only Lock**: prevent change.
  - **Delete Lock**: prevent deletion.
- **Resource Provider**
  - service that supplies resources you can deploy and manage through the 'Resource Manager'.
  - e.g. Microsoft.Compute, Microsoft.Storage, Microsoft.KeyVault, Microsoft.Web...
  - resource type is in the format: `{resource-provider}/{resource-type}`. For example, the key vault type is `Microsoft.KeyVault/vaults`.
- **Resource Tagging**
  - tags(**done at the resource level**) allow sorting, searching, managing and analysis.
  - tags do **not** have inheritance(**tags are not inherited from resource group**).
  - user must have **_write_** access(**Contributor** role or higher).
  - name:value
  - max 50 labels per resource/resource group.
- **template**
  - JSON(javascript object notation) file that defines one or more resources, to **deploy to a resource group**.

## Azure Management Groups and Policies

- **Management Groups**
  - level of scope and control(manage access, policy and compliance) across **subscriptions**.
  - use management groups to target policies and spending budgets across **subscriptions**.
  - all subscriptions within management group inherit policy. e.g. specific region to create VMs.
  - enforce compliance rules with management groups.
  - ![management group](img/management_group.PNG)
  - ![az scope](img/az-scopes-billing.png)
- **Policy and Policy Definition**
  - **Policy**
    - express how the environment is governed for all users at a specified scope regardless of any RBAC assignments.
    - Policy is a default allow mechanism with an explicit deny system.
    - create, assign, and manage policies to control or audit your resources.
    - enforce rules and ensure compliance with corporate standards and service level agreements.
    - **enforcement and compliance, scaling, and remediation**.
  - **Policy Definition**
    - **JSON format**. Express condition to evaluate and actions to perform when condition is met.
    - enforce different rules and effects over your resources, so those resources stay compliant with your IT governance standards.
  - individual resources, resource groups, subscriptions can be exempted from policy.
    - e.g. cannot deploy VM if it has an exposed public IP address.
- **Initiative Definition**
  - A **group of related policies** joined logically to accomplish a common goal is called an **Azure initiative**.
  - help you track one or more policy definition compliance state.
  - scope can be limited to certain groups.
  - e.g. similar to lego blocks, logically combine multiple policies and apply them as one.
- **Policy Compliance**
  - see what percentage of your infrastructure is compliant with policy.
  - determine the compliance state of your resources and evaluate whether they're compliant.

## Azure Subscriptions and Cost Management

- **Subscriptions**
  - manage cost for organizations. help you organize access to Azure cloud service resources, and help you control how resource usage is reported, billed, and paid.
  - Azure Subscription is a logical unit of Azure services that's linked to an Azure account(Microsoft Entra **tenant**).
  - **Classic Subscription Roles**: Account Administrator, Service Administrator, or Co-Administrator. It is recommended to use Azure **RBAC** roles for more granular control.
    - there can be only **one** account or service administrator per subscription.
  - **Rules**
    - all Azure cloud services will belong to a subscription. billing is done per subscription.
    - Azure account can have multiple subscriptions.
    - a subscription can be linked to multiple Azure accounts.
  - ![subscription](img/subscription.PNG)
  - ![az scope](img/az-scopes-billing.png)
- **subscription types**
  - **Free Trial**: 30 day free.
  - **Pay-As-You-Go**: charges you monthly for the services you used in that billing period.
  - **Enterprise Agreement**: buy cloud services and software licenses under one agreement.
  - **Student**: monetary credit that can be used within the first 12 months.
- **Subscription Cost Management**
  - **Resource Quotas**: limits on the amount of resources available. e.g. number of cores available for virtual machines is limited to 20 per region.
- **Cost Management**
  - you pay only for what you use. Shows the usage-based costs consumed by Azure services and third-party Marketplace offerings.
  - Predictive analytics are available.
  - Azure management groups, budgets, and recommendations to show how your expenses are organized and how to reduce cost.
  - Cost data can be exported.
- **Cost Budgets, Recommendations, Analysis**
  - **Budget**: set limits to prevent overspending. must have **_reader_** access to view.
  - **Recommendations**: learn how to optimize and improve efficiency of idle or underutilized resources.
  - **Analysis**: explore where the money is going and spending trends.
  - **export**: data can be set to automatically export csv daily.
- **Cost Savings**
  - **Reservations**: pay ahead. 1-3 years. VM, Database,
  - **Azure Hybrid**: use your **_Software Assurance_** on-prem licenses(Windows Server, SQL Server...).
  - **Azure Credits**: Visual Studio Subscribers get monthly credits for development.
  - **Azure Regions**: compare region pricing.
  - **Budgets**: manage cost, prevent overspending.
  - **Pricing Calculator**: estimate usage: Compute, networking, storage, web, database.

## User Identity and Group Accounts with Entra ID

- **user account**
  - anyone who wants to access an Azure resource, must have an Azure user account.
  - **Entra ID cloud identity user accounts can be added through**:
    - Azure portal, Microsoft 365 Admin Center, Microsoft Intune admin console, and the Azure CLI.
- **Entra ID three types of user accounts**
  - **Cloud**: **cloud identity** accounts.
    - Cloud identities have profile information such as job title and office location.
  - **Hybrid**: when user has on-prem AD account (**_directory-synchronized identity_**) synchronized w/ Entra ID via Entra Connect.
  - **Guest**: outside of Azure. e.g. external vendor or contractor need access to your Azure resources.
- **who can create/delete users**
  - only global admins can create/delete users.
- **Security/Microsoft 365 group accounts**
  - two types of group accounts:
    - **Security groups**: manage users and computer/app access through security policy.
      - set permissions for all group members at same time.
      - managed only by **Microsoft Entra Administrator**.
    - **Microsoft 365 groups**: group access to apps. e.g. mailbox, calendar, files, sharepoint...
      - allow access to normal users and guest accounts.
- **administrative units**
  - **restricts administrative scope**. admins can have greater privileges than others depending on the scope of their responsibilities.
  - ![administrative units](img/administrative_units.PNG)

## Azure RBAC (Role Based Access Control) and Entra Roles

- **RBAC**
  - Azure RBAC and Microsoft Entra roles are different.
  - **RBAC**: applies policy to infrastructure(VM, DataBase, Storage...).
    - manage who can access their resources, and what actions are allowed.
    - control access to data and resources by specifying roles and access privileges for employees and business partners.
    - create role definitions and role assignments.
  - **Entra Role**: applies policy to identities(users, groups, domains).
- **Security Principal**
  - object that represents something(**Requestor**) requesting access to resource.
  - Requestors can be internal or external users, groups of users, applications and services(**_service principal_**), resources, and so on.
- **Role Definition**
  - JSON list of allowed permissions. least privilege.
  - **Built-In Roles**
    - **owner** built-in role has the **highest level of access privilege** in Azure.
    - **user access administrator**: manage(create/delete) user access to resource.
    - **contributor**: manage(create/modify/delete) resource. Cannot grant access to others.
    - **reader**: view resource.
  - The system **subtracts NotActions** permissions from **Actions** permissions to determine the **_effective permissions_** for a role.
  - **JSON**
    - **Actions**: permissions identify what actions are allowed.
    - **NotActions**: permissions specify what actions **aren't** allowed.
    - **DataActions**: permissions indicate how data can be changed or used.
    - **AssignableScopes**: permissions list the scopes where a role definition can be assigned
    - ![role definition](img/role_definition.PNG)
    - ![role definition2](img/role_definition2.PNG)
    - ![az scope](img/az-scopes-billing.png)
- **scope**
  - how many resources(assignable scope) security principal is granted access.
  - **_AssignableScopes_**: permissions for a role can be management groups, subscriptions, resource groups, or resources.
- **Role Assignment**
  - **assignment** attaches **role definition** to a **security principal** at a particular **scope**.
  - purpose of a role assignment is to control access.
  - Role Assignment parts:
    - **Security Principal**: **who**. something/someone(VM service, user) requesting access to resource.
    - **Role Definition**: **what**. JSON list of **effective permissions**(built in: owner, contributor, reader, user access administrator).
    - **Scope**: **where**. how many resources security principal is granted access(management group -> subscription -> resource group -> resource). **Permissions in sub-levels are inherited**.
    - ![RBAC scope](img/rbac_scope.PNG)
    - ![Role definition](img/role_definition2.PNG)
- **Classic Subscription Administrator Role vs RBAC Role vs Entra Role**
  - **Classic Subscription Administrator**: Azure first role policy.
    - Account Administrator, Service Administrator, and Co-Administrator. Access was controlled by assigning admin roles to subscriptions.
  - **Azure RBAC**: added fine grain control and custom roles on resources(VM, DB, Storage...).
  - **Entra Administrator Role**: adds ability to manage users, groups, domains in Microsoft Entra resources(apps). Scope is defined at **_tenant_** level.
    - controls access at a higher level than RBAC.
  - ![rbac entra roles](img/rbac_entra_roles.PNG)
  - ![az scope](img/az-scopes-billing.png)
- **Entra and RBAC solve what Identity and Access concern of the Cloud**
  - when employees leave, lose access to resources in cloud.
  - being able to centrally control network communication, while allowing employee autonomy(create/manage VMs).
  - Entra and RBAC work together to address these concerns.
- **Entra User**
  - when a user is added, they are granted default permissions.
    - Varies by: type of user(admin, member, guest), role assignment, ownership of individual objects.
- **Entra Administrator Role**
  - create/delete/assign users.
  - you can restore deleted users within 30 days of deletion.

```powershell
# create a new user
New-MgUser
# remove user
Remove-MgUser
```

- **Entra Member Role**
  - manage their profile. considered internal to organization.
  - by default can invite guest.
- **Entra Guest Role**
  - invite someone to collaborate with organization, most restricted permissions.
- **Entra Groups**
  - apply roles to all members of group.
  - **Direct assignment**: you manually give them role assignment.
  - **Group assignment**: you assign group role.
  - **Rule-based assignment(Dynamic Assignment)**: rules based on user or device.
- **Entra B2B**
  - external team collaboration. add external collaborators as **guest users**.
  - By default, **users**(members) and **administrators** in Microsoft Entra ID can **invite guest users**.
  - connect multiple **internal tenants** for collaboration.
    - e.g. tenant A needs access to resource in tenant B.
  - **Why B2B**
    - instead of having to manage each external collaborator, you can set roles and they have to manage themselves.
    - you don't take the responsibility of managing, authenticating the credentials and identities of external users.
    - **federation**: Entra B2B is easier than using on-prem AD FS(federation service). To use AD FS you have to add an internet facing proxy for them to log into.
      - Good for keeping all auth local, but if your network goes down, no one can connect.
    - ![federation](img/federation.PNG)
- **Entra Connect Cloud Sync and Sync**
  - **Entra Connect Cloud Sync**
    - engine runs in cloud.
  - **Entra Connect Sync**
    - engine runs on-prem with AD. Flows one-way. Authorization is verified from the on-prem engine.
- **Entra Domain Services: Entra Connect**
  - Providing authentication when you have on-prem AD DS and apps on cloud VMs:
    - site-to-site VPN. on-prem -> cloud. = expensive.
    - replica AD DS on VM in the cloud. = expensive.
    - **Entra Connect** solves this problem:
      - Provides AD DS services: GPO w/ kerberos auth to Microsoft Entra tenant. Allows on-prem AD DS to communicate with cloud services.
      - If you don't have on-prem AD DS, Entra Connect works by providing you support to your on-prem infrastructure through a site-to-site VPN.
      - freely migrate applications that use LDAP, NTLM, or the Kerberos protocols from your on-premises infrastructure to the cloud.
- **Entra ID vs Active Directory**
  - **Entra ID**
    - Microsoft Entra ID is a cloud-based identity and access management service(PaaS). Allows employees can use to access external resources. e.g. Microsoft 365, Azure Portal...
    - SAML, WS-Federation, and OpenID Connect for authentication, and uses OAuth for authorization.
    - focused on providing **identity management** services to **web-based apps**, unlike **AD DS**, which is more focused on **on-premises apps**.
    - Entra ID users have access to a set of features that **aren’t natively available in AD DS**, such as support for **multi-factor authentication, identity protection, and self-service password reset**.
      - primarily an **identity solution** for internet based(**https**) communications.
      - multi-tenant directory service.
      - provides **directory services**: stores and handles the authentication and authorization of the **users, devices, and applications**.
      - Entra is **managed** by **REST API** over https.
      - Entra ID includes **federation services**(sign-in once, authenticate to multiple services).
  - **AD(active directory)**
    - Active Directory Domain Services (AD DS or traditionally called just "Active Directory").
    - directory service that provides the methods for storing directory data, such as **user accounts and passwords**, and makes this data available to network users, administrators, and other devices and services. It runs as a service on **Windows Server**, referred to as a **domain controller**.
    - authentication: **kerberos** for identity.
    - true X.500 based structure. Uses DNS for locating resources on network.
    - OUs(organizational units) and GPOs(group policy objects) for management.
    - You can query and manage AD DS by using Lightweight Directory Access Protocol (LDAP) calls.
    - AD DS can be deployed on a virtual machine, but does not use Microsoft Entra ID.
- **Entra ID P2 over P1**
  - P2 has
    - Entra ID protection: enhanced security/monitoring user accounts.
    - Entra Privileged Identity Management: additional security levels for admins(permanent and temporary).
- **Entra Schema**
  - no definition of 'computer' class(AD has 'computer' class definition). Uses 'device' class instead.
    - lack of support of 'computer' domain, you can't manage GPOs, instead Entra provides **directory services**: stores and handles the authentication and authorization of the **users, devices, and applications**.
  - **no OU(AD organizational unit)** class. Policy scope and delegation organization is done by '**group membership**'.
- **Entra tenant**
  - [microsoft definition](https://learn.microsoft.com/en-us/microsoft-365/enterprise/subscriptions-licenses-accounts-and-tenants-for-microsoft-cloud-offerings?view=o365-worldwide#tenants)
  - [tenant](https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-create-new-tenant)
  - A tenant represents an organization. It's a dedicated instance of Microsoft Entra ID that an organization or app developer receives at the beginning of a relationship with Microsoft(yourname.onmicrosoft.com).
  - An organization can have multiple Microsoft Entra instances(tenant). This allows separation.
  - An Azure subscription can have only one Microsoft Entra tenant.
  - e.g. your piece in the cloud with your name like **yourname.onmicrosoft.com** that you lease from microsoft.
    - An organization can have multiple Microsoft Entra tenants.
    - An organization can have multiple Azure subscriptions(each subscription must be associated with one, and only one, Microsoft Entra tenant).
    - A subscription can have multiple licenses.
    - Licenses can be assigned to individual user accounts.
    - RBAC(grant permissions to resources in the Azure subscription) and User accounts are stored in your Microsoft Entra tenant(yourname.onmicrosoft.com).
  - ![az scope](img/az-scopes-billing.png)
- **Entra SSPW (self service password reset)**
  - user can reset their password.
  - user is considered 'registered' when they setup the required amount of password resets.
  - a strong two-method authentication policy is always applied to accounts with an administrator role.
    - security-question method is not available for administrator roles.
  - **Best Practices**
    - Enable two or more of the authentication reset request methods.
    - Use the mobile app notification or code as the primary method, but also enable the email or office phone methods to support users without mobile devices.
    - The mobile phone method isn't a recommended method, because it's possible to send fraudulent SMS messages.
    - The security-question option is the least recommended method, because the answers to the security questions might be known to other people. Only use the security-question method in combination with at least one other method.
- **Entra Domain Names**
  - microsoft gives you a sub-domain: `yourName.onmicrosoft.com`
  - add your domain name. e.g. `example.com`

## Azure Region and Storage Redundancy

- **Describe Azure Geography, regions, region pairs, and sovereign regions, availability zones, availability sets, fault domains, update domains**
  - **Geography**: groups of regions in each continent.
    - Americas, Europe, Asia Pacific, Middle East and Africa.
  - **Regions**: one or more datacenters connected w/ low-latency communications. For redundancy.
    - preserve data residency(keep data inside the region) for compliance and resiliency depending on customer needs.
  - **Region Pairs**: two regions in same geography **300+ miles apart** linked for disaster recovery.
  - **Sovereign Regions**: separation for compliance or legal purpose. physical and logical isolation.
    - e.g. (US government and US government contractors).
  - **Availability Zones**
    - group of datacenters within a region networked w/ low-latency network, each with redundant power, network, cooling.
    - redundancy with **datacenter failure**.
  - **Azure Datacenters**
    - physical buildings w/ servers. redundant network, power, cooling.
  - **Availability Set**
    - within same datacenter, group of identical VMs spread across **fault domains**(share: compute racks, storage units, network switches, power) and **update domains**(reboot same time).
    - protection from **hardware failure** within datacenter.
    - VMs in **different fault domains** that perform identical functionalities.
    - VMs should have the same software installed.
  - **Fault Domain**
    - VMs that share the same hardware, network, and power in a datacenter. single point of failure.
    - across fault domains are **group of servers** that have separate hardware, network, power.
  - **Update Domain**
    - VMs that will receive Azure hardware updates(and will be rebooted) at same time.
  - ![high availability](img/04-azure-global-infra.jpg)
  - ![availability set](img/AvailabilitySet.webp)
  - ![availability zones](img/Azure-Availability-zone-infographic.png)
- **Storage Redundancy**
  - **LRS**: local redundant storage. **synchronous**. creates **three** copies of data in **availability set**(within **same datacenter** across fault and update domains). protection from hardware failure.
  - **ZRS**: zone redundant storage. **synchronous**. creates **three** copies data across **availability zones**(linked datacenters) within a region. protection from datacenter failure.
  - **GRS**: geo-redundant storage. **primary LRS**, secondary region **asynchronous** LRS hundreds of miles away. protection from disaster.
  - **RA-GRS**: Read-access geo-redundant storage. because secondary storage data cannot be read until primary fails, this method allows you to **read from secondary, with primary still working**.
  - **GZRS**: geo-zone redundant storage. **primary ZRS**, secondary **asynchronously** LRS. protection against regional disasters.
  - [Microsoft Learn: Storage Options](https://learn.microsoft.com/en-us/azure/storage/common/storage-redundancy)
  - ![storage reliability](img/storage_reliability.PNG)
  - ![high availability](img/04-azure-global-infra.jpg)
  - ![availability zones](img/Azure-Availability-zone-infographic.png)

## VMs

- **VMs**
  - IaaS. instant compute. scalable.
  - compute is per hour charge(per minute).
  - **Setup**
    - choose network(topology must be designed first) and create name(windows 15 char, linux 64 char) for VM.
    - select compute cpu size, ram and size hdd/ssd.
    - select OS.
    - region changes pricing.
  - ![vm compute](img/vm_compute.PNG)
  - ![vm setup](img/vm_setup.PNG)
- **VM NIC**
  - every VM has one or more vNIC(virtual network interface card).
  - JSON: "VMNicName": "MyVnic"
- **VM Storage**
  - managed by Azure. You choose disk size.
  - storage is scalable. charged separately from compute.
  - all VMs have two disk: OS disk(pre-installed operating system) and temporary disk.
    - temporary disk is not persistent.
  - **VHDs**: disk mapped to VM. page blobs.
  - **Permanent Storage**: **data disk**. can be SSD or HDD. page blobs.
  - **Premium Storage**: Premium SSD. optimized for I/O-intensive workloads(80,000 IOPS, mission critical). throughput 2,000 MB/s.
  - **unmanaged data disk**: manual scale to disk needs.
  - **managed data disk**: Azure scales disk to VM needs.
- **VM Bastion**
  - PaaS. secure access to RDP(windows)/SSH(linux) over SSL. VM doesn't need public IP.
- **VM Maintenance Planning**
  - unplanned hardware failure: predicted failure of physical machine.
  - unexpected downtime: physical machine fails.
  - planned maintenance: hardware update/upgrade.
- **VM Scaling and Scale Sets**
  - **Vertical Scaling**: **scale up/down**. add more resources(compute, ram, HDD...).
  - **Horizontal Scaling**: **scale out(increase)/in**. add more VMs.
  - **Scale Sets**: manage set of **_identical VMs_**. True autoscaling.
    - automatically increases/decrease VM instances based on demand.
    - support **Azure Load Balancer**(layer-4) and **Azure Application Gateway**(layer-7).
- **VM ARM Templates**
  - **schema**: JSON.
    - **parameters**: values passed at runtime. pass value from parent to child ARM template.
    - **variables**: avoid repeating code.
    - **functions**: avoid repeating code.
      - **You cannot access variables or any other user-defined functions within your function.**
    - **resources**: resource group items. **_dependsOn_** determines which resources must be deployed first before a specific resource.
    - **outputs**: message returned after resource deployed.
  - **Infrastructure as Code (IaC)**: supports two different deployment modes: complete and incremental.
    - **Incremental**: leaves existing resources not in ARM template unchanged.
    - **Complete**: mirror ARM templates(delete anything not in templates).
      - **Complete Mode can only be enabled with REST API or Shell tools with the "--mode: complete" set**.
- **VM Script Extensions**
  - Azure VM built-in extension for configuration management after deploy or when provisioning.
  - script must be accessible from URI(Azure Storage Account).

## Azure Storage

- **Azure Storage Account**
  - <https://tutorialsdojo.com/azure-storage-overview/>
  - goals: scalable, reliable. Handle high traffic w/ data durability. Quick restore of outage.
  - All storage is encrypted at rest with SSE(storage service encryption).
  - container that allows you to manage as a group all Azure storage services(**queue, blob, file share, table, Azure Data Lake Storage**) together. similar to a resource group for storage.
  - policy applied to container, all storage services within container inherit the policy.
  - Database(SQL, Cosmos...) cannot be inside storage account.
  - LRS(local redundant storage) is the minimum replication(3 copies in same datacenter(across fault domains). hardware failure protection).
  - **Creating New Storage Account**:
    - **Name**: globally unique. letter and number only.
    - **Performance**: Standard | Premium(better I/O, SSD, database). // [a-z0-9]{3,24} cannot be changed later.
    - **Account Kind**: General-Purpose V2 | (classic V1), BlockBlobStorage, FileStorage, and BlobStorage.
    - **Replication Option**: LRS, ZRS, GRS...
    - **Access Tier**: Hot, Cool, Cold, Archive // **only V2**.
  - ![storage account](img/storage_account.PNG)
- **Azure storage services: blob, disk, file, table, queue**
  - **blob (Binary Large OBject)**: **unstructured**, _nonrelational_ data. Any type of binary data, typically large files(archives), video, images...
  - **disk**: **block-level** storage for persistent VM data. stored as **page-blobs** in blob storage.
  - **file**: mimics a SMB or NFS **file server**. file sharing access and management. by default, data is **encrypted** at rest and in transit.
  - **table**: **structured NoSQL** _nonrelational_ data. e.g. key:value like mongodb.
  - **queue**: **messages** accessible from anywhere through HTTPS calls.
- **Blob Storage**
  - good for serving images(to browser), **streaming** video, distributed access, archive/recovery, disk(page blob).
  - **all blob storage must be in a container**.
  - **Blob Types**
    - blob any data type any size. All three types can share a container.
    - type cannot be changed after creation. Must re-upload to change type.
    - **block blob**: default. block data storage. e.g. video, large text files, images, binary...
    - **page blob**: 8TB max size. optimized read/write operations. e.g. VM disk.
    - **append blob**: optimized for append data. e.g. logging.
  - ![blob storage](img/blob_storage.PNG)
  - ![blob vs file share](img/file_share_vs_blob.PNG)
- **Blob Soft Delete**
  - V2 storage: default 14 days, max retention: **365 days**.
- **Blob Storage Lifecycle Management**
  - set rules to automatically move blob object into a cheaper tier(cool, cold, archive) when not accessed in a certain time period.
  - Each tier represents a trade-off of performance, availability, and cost.
  - change blob access tiers **without having to move data** between accounts. All requests to change tier will take place immediately between Hot and Cool tiers.
  - **Cost**:
    - manage costs by organizing data based on **how frequently it will be accessed** and **how long it will be retained**.
    - data **storage cost decrease** and **access cost increases** as tier gets **cooler**.
    - data cost to transfer(replicate to another region, move out of Azure, per-gigabyte charge).
    - Hot, Cool, Cold transfer happens immediately. Archive takes time.
    - Hot: immediate access. highest storage cost, lowest access cost. frequently accessed.
    - Cool: immediate access. infrequently accessed. retained at least 30 days.
    - Cold: immediate access. infrequently accessed. retained at least 90 days.
    - Archive: **Data in the Archive storage tier is stored offline and must be rehydrated to the Cool or Hot tier before it can be accessed.** This process can take up to 15 hours. infrequent access. retained at least 180 days.
    - Hot -> cool: incurs a **write** charge for all data.
    - Cool -> Hot: incurs **read** charge for all data.
  - ![blob storage lifecycle](img/blob_storage_lifecycle.PNG)
- **Blob Object Replication**
  - blobs copied asynchronously.
  - complete blob object is copied(metadata, version history, blob contents).
  - blob versioning must be enabled on both source and destination, to perform replication.
  - snapshots **are not** replicated.
  - replication can only be between Hot, Cool, or Cold.
  - ![blob storage replication](img/blob_storage_replication.PNG)
- **Storage Endpoint URL**
  - each object in storage is prefixed with `YOURNAME.SERVICE.core.windows.net/myStorageName/myblob`
  - names must be **globally** unique.
  - you can map a custom endpoint: `blob.example.com`. This is done by CNAME(points to Azure) from DNS provider.
  - ![storage endpoint](img/storage_endpoint.PNG)
- **File Share**
  - Microsoft managed files in the cloud that are accessible via industry standard protocols(**SMB(tcp port 445), NFS**) through a **REST API**.
  - classic: to access **Azure File Share** through **SAS** URI, you must use the **REST API**.
  - stores data as **true directory objects**, so can be **mounted like SMB(tcp port 445) or NFS**.
  - multiple (VMs, on-prem computers(windows, macOS, linux), roles, services...) can access(mount) an Azure file share simultaneously, from anywhere in the world(REST interface).
  - embraces **lift and shift**(take the workload as-is and run it on cloud-native resources).
  - good for: configuration files, logs, metrics, crash dumps...
  - **Premium vs Standard**:
    - **standard**: HDD. format: SMB, REST
    - **premium**: SSD. format: SMB, NFS, REST.
  - ![blob vs file share](img/file_share_vs_blob.PNG)
- **File Share Snapshots**
  - **point-in-time read only copy of file share**.
  - only data that has changed(from last snapshot) is recorded. Only most recent share is needed to restore the share.
  - single files can be restored from snapshot.
  - all snapshots must be deleted before share can be deleted.
  - snapshot can act like a versioning system, previous files can be recovered.
- **File Share Soft Delete**
  - recover deleted files and file shares. Once marked for deletion, you can set retention period: **1-365 days**.
  - soft delete **does not work on NFS shares**.
  - Advantages: ransomware protection, comply with data retention policy, restore to known good state, recovery from accidental data loss.
- **Azure Storage Explorer**
  - access multiple accounts and subscriptions, and manage all your Storage content on **windows, macOS, linux**.
  - requires both management (Azure Resource Manager) and Active Directory permissions to allow full access to your resources.
  - ![Azure storage explorer](img/storage_explorer.PNG)
- **File Sync and Cloud Tiering**
  - **cache files and synchronize between Azure and on-prem Windows Server or cloud VM**.
  - any number of caches in any location.
  - **Multi-Site Access**: write on-prem (linux, windows server protocols: SMB, NFS, FTPS) and cloud.
  - file sync backs up on-prem files with Azure File Share.
  - **Cloud Tiering**
    - only allow frequently accessed files to be cached locally(free up local cache).
    - when file is **tiered**, file is replaced with pointer(URL to Azure File Share) instead of it being cached locally.
    - tiered file is marked with an `O` and greyed out to show file is only in Azure.

## Storage Security

- **Blob Storage Access Levels**
  - extra access controls only for blob storage.
  - blob storage is organized by containers and blobs. These can have **ACL**s(access control levels).
  - a storage account can include an **unlimited number of containers**, and a container can store an **unlimited number of blobs**.
  - access level can be changed through the Azure portal, Shell, or by using Azure Storage Explorer.
  - **Private**: default. private URI. only storage account owner can access blob or container.
  - **Blob**: public URI. Blob data within this container can be read via anonymous request, but container data isn't available.
  - **Container**: public URI. Container and all blob data can be read via anonymous request.
- **Storage Security**
  - **disk encryption**: Azure Disk Encryption. all data written encrypted by default(Azure storage encryption, 256 bit AES). decrypted automatically. transparent to users. cannot be disabled.
  - **data in transit**: Azure Client-Side Encryption, HTTPS, SMB 3.0.
  - **Public Access**: when **_AllowBlobPublicAccess_** is set to true and container public access is set.
  - **Shared Access Signature (SAS)**: URI with read or read/write permissions that expire.
  - **shared key**: key produces encrypted signature. passed in Authorization header.
  - **authentication**: Entra ID(user identity) and RBAC(resource permissions). prove your identity
  - **authorization**: RBAC. you have access rights to resource.
  - **Entra ID**: enables access to authorized person.
- **Private Link**
  - data shared between services along microsoft backbone instead public internet.
  - ![private link](img/private_link.PNG)
- **Shared Access Signature**
  - uniform resource identifier(URI): grant access to a **specific resource**, for a **specified period of time**, and with a **specified set of permissions** to Azure Storage resources(containers, blobs, queues, tables...).
    - e.g. `https://myaccount.blob.core.windows.net/?restype=service&comp=properties&sv=2015-04-05&ss=bf&st=2015-04-29T22%3A18%3A26Z&se=2015-04-30T02%3A23%3A26Z&sr=b&sp=rw&sip=168.1.5.60-168.1.5.70&spr=https&sig=F%6GRVAZ5Cdj2Pw4tgU7IlSTkWgn7bUkkAg8P6HESXwmf%4B`
  - purpose: give client who normally does not have access, a URI for a specified time period, to prevent account keys exposure.
  - granular control(read, write, delete...) of resource permissions(blobs, files, queues, tables). restrict IP address, protocol used(https or http).
  - **account-level**: one or more services.
  - **service-level**: only one service.
- **Stored Access Policy**
  - to revoke SAS, you have to delete the secret key or resource, creating a need to decouple permissions from the token itself.
  - Stored Access Policy creates start/end times, access permissions independently from SAS token. the SAS token gets generated with a **reference to this policy** instead of embedding access parameters explicitly.
    - can be applied to a container and every service in container.
    - Set rules: start time, expiry time, permissions.
    - reference policy when you create SAS.
    - revoke SAS token by deleting/renaming or modifying expiry time of policy.
- **Storage Account Access Keys**
  - each storage account has two keys(switch primary key without down time.).
  - **access keys** allow full access(CRUD) to all services within storage account.
  - store in **Azure key vault** for safety.
  - **Connection String**
    - classic way to manage(full access) storage data using Shared Key authorization(Storage Access key).
    - Use Microsoft Entra ID or SAS URI with Security Policy instead.
    - **connection string is retrievable by opening the storage account blade in the Azure Portal and clicking Access Keys.**
- **Azure Key Vault**
  - HSM(hardware security module)s safeguard keys.
  - **Customer Managed Keys**: create your own key. greater control(create, audit, rotate, delete...).
- **Storage Security Best Practices**
  - set permissions to minimum and time to minimum.
  - use HTTPS and **User Delegation** to create SAS, because key does not have to be embedded in the URL.
  - **data**: encrypted at rest and in transit.
  - **WAF firewall**: Web Application Firewall. Layer 7 aware. Route and filter traffic(SQL injection, XSS...). block IP address. **Application Gateway** or **Front Door**.
  - **private link**: wrap data resource in VPN and share data between services along Azure backbone instead of public internet. shields DB from outside world.
  - **restrict access to VM's**: disable RDP(remote desktop protocol) and SSH. Keep VM on private network, connect through **Azure Bastion**.
  - **Secret Keys**: Azure Key Vault. To connect services to Azure Key Vault, use **Managed Service Identities**.
  - **Production**: use separate subscription for production environment. Development policies and Production policies can be controlled.
  - **Resources**: RBAC to allow users permissions on resources.
  - **Azure Security Center**: Azure service that informs you of your security state and what can be improved.

## Azure Backup

- **Azure Backup**
  - enterprise-class backup solution to protect all your workloads and manage them from a central place.
  - complete data recovery, high security storage(encrypted at rest), protection against ransomware or malicious admins(soft delete, min 14 days).
  - **create scheduled backups**: data, machine state, and workloads, running on on-premises machines and VM instances to the Azure cloud.
  - VM(linux or windows) backup using agent(extension) software. stores in vault.
  - ![vm backup](img/vm_backup.PNG)
  - **Zone or Region**: customer choice. LRS(across fault domain), GRS(across geographies), ZRS(across datacenters, datacenter failure).
  - **vaults**: orchestrate and manage backups. - interface to interact with your data and stores the backed-up data in **Recovery Services vaults** and **Backup vaults**.
  - single vault or multiple vaults to organize and manage your backup.
  - **Backup Types**
    - **Planned**: known in advance.
    - **Unplanned**: backup with custom retention.
    - **On-Demand**: not scheduled.
  - **Workload integration layer**: VM disk backup.
  - **Data Plane -Access Tiers**: Azure Backup managed storage.
    - **Snapshot tier**: fastest to restore. stored with **customer data, and in vault**. You do not have to wait for data to be copied from vault.
    - **Standard tier**: stored in Microsoft managed vault. isolated copy.
    - **Archive tier**: **Long-Term Retention (LTR)**. rarely accessed.
  - **Data Plane -Availability and Security**: cross zone or region backups.
  - **Management Plane -Recovery Vault**: interface to interact with backup service.
- **Describe redundancy options**
  - backup copies in local, zone, region.
- **Backup Tiers**
  - **hot**: online tier(immediate access), frequent access.
  - **cool**: online tier(immediate access), infrequent access. 30 day storage.
  - **cold**: online tier(immediate access), rarely accessed. 90 day storage.
  - **archive**: **offline** tier(low priority, high latency, several hours to access), rarely accessed. 180 day storage.
  - cooler tiers have **lower** storage, but **higher** access cost.
  - ![storage access tiers](img/storage_access_tier.PNG)
- **Identify options for moving files, including AzCopy, Azure Storage Explorer, and Azure File Sync**
  - **AzCopy**: cmd line utility.
    - **fault tolerant, large-scale bulk transfer of data**.
    - **asynchronously** copy **blobs** or **files**.
    - allows **incremental backup**.
    - permissions: Azure login, service principal, SAS token, access key, managed identity...
  - **Azure Storage Explorer**: GUI to manage all/multiple storage(blob, file, queue, tables, database, data lake) accounts.
  - **Azure File Sync**: centralize files. **Automated bi-directional sync** from **Cloud with on-prem**. Installs on Windows Server.
- **Describe migration options, including Azure Migrate and Azure Data Box**
  - **Azure Migrate**: hub of services and tools designed to help with data migration.
  - **Azure Data Box**: send terabytes of data into and out of Azure in a quick, inexpensive, and reliable fashion. Shipped 'data box'. Basically it's a 'storage drive' with your data on it, that is shipped to you.
  - **Azure Import/Export**:
    - same as Azure Data Box, but you supply the hard drives, Microsoft copies your data and ships to you.
    - first step to use tool, download **WAImportExport** program. **V1 for blob storage, V2 for File Shares**.
- **Backup center**
  - manage all backup vaults(spanning multiple workload types, vaults, subscriptions, regions, and Azure Lighthouse tenants).
- **Azure Recovery Services vault**
  - storage entity in Azure that houses data(VM, SQL...).
  - cannot be deleted until all soft-deleted items are removed.
- **Azure Site Recovery**
  - backup complete footprint(business continuity by replicating workloads) to another region. natural disaster recovery.
  - Azure VM and on-prem computers can be replicated.
  - ![site recovery](img/site-recovery.PNG)
- **VM SQL Database**
  - when running VM with SQL database, Azure backup does a **Stream Backup**.
  - **VM SQL Backup Types**
    - **Full**: full recovery of all data.
    - **Differential**: full backup, then only data that has changed.
    - **Transaction Log**: SQL transactions log backup.
- **Soft Delete**
  - default 14 day retention after deletion.
  - no backup jobs can be running.
  - **UnDelete**
    - unDelete backup data before you can restore it.
- **VM and On-Prem Computer Backup**
  - **Microsoft Azure Recovery Service (MARS)**: file, folders, VM state, **windows on-prem** backup.
    - Microsoft Azure Backup Server (MABS), Azure managed disks snapshots, and Azure Site Recovery.
  - **VMs (Windows and Linux)**: Azure Backup installs agent(extension) on VM. Backs up entire VM.
  - **Azure Managed Disk Snapshot**
    - VM single disk backup. read-only full copy of single disk. can be used to create template. billed for data backed up, not disk size.
    - stored as **page blobs**(Azure Disk) in vault.
    - default retention is **two days** before moving snapshot to Recovery Service Vault.
    - **recovery point** is available only after both phases(snapshot and transfer to vault) have completed. you can still restore your VM from snapshot before transfer phase.
    - ![vm backup](img/vm_backup.PNG)
  - **Azure Managed Disk Image**
    - single image from **all** VM data disk including the OS disk. can be used to create template.
    - stores in vault.
    - ![vm backup](img/vm_backup.PNG)
- **When to Backup**
  - Azure Backup **doesn’t** support **cross-region backup** for most workloads.
  - **Types**
    - **Workload recovery**: VM, Disk, SQL, SAP, HANA, Blobs...
    - **Compliance**: customer defined retention.
    - **Operational recovery**: key items to ensure against data loss.
  - **Steps**
    - create Recovery Service vault. created within your **subscription**.
      - choose replication: GRS(default) or LRS.
    - define your backup policy options. when and how long to retain.
    - back up your VM. on-prem backup must have agent must be installed on VM.

## App Services

- **App Service Plans**
  - PaaS. HTTP-based service for hosting, develop and deploying web, mobile, and API apps.
  - defines a set of **compute resources**(how many VMs, compute, disk for each VM) for a web application to run on.
  - configuration settings include runtime stack(node, python, dotnet...), operating system, region and App Service plan(standard, premium, isolated...).
  - brings together everything you need to create websites, mobile backends, and web APIs for any platform or device.
  - **Free or Shared Tier**
    - can't scale. charged CPU minutes used.
  - **Basic, Standard, Premium, or Isolated Tier**
    - VMs in your App Service are yours to use as you want.
  - **Setup**
    - **Region**: location of datacenter. e.g. 'East US'.
    - **Number of VM instances**: how many VM instances allocated to plan.
    - **Size of VM instances**: compute. Small, Medium, Large.
- **Continuous Integration and Deployment CI/CD**
  - **automated deployment**: automate the testing and deployment of code changes.
  - **Azure DevOps**: Azure devops pipeline. code changes -> testing -> deploy.
- **CI/CD Deployment Slots**
  - with App Service, instead of deploying to production node, you deploy to another node with **it's own hostname**.
  - manage different app stages(development, testing, staging, and production).
  - available in the **Standard, Premium, and Isolated** App Service pricing tiers.
  - similar to **_blue/green_** deployment strategy. Rollback if "**_swap_**" is not as expected.
  - new deployment slots can be empty or cloned.
  - ![deployment slot](img/deployment_slot.PNG)
- **App Service Authentication and Authorization**
  - Security Module: authenticate users, manage tokens, sessions, and inject identity into request headers.
  - built-in authentication and authorization support.
  - configured by using App settings, when enabled, every HTTP request will pass through the security module before it's handled by your App.
  - automatic logging of authentication and authorization traces.
  - **Settings**
    - **Allow Anonymous Request**: defer authorization of unauthenticated traffic to your App.
    - **Allow only authenticated request**: **_all_** anonymous traffic is sent to login provider page.
- **Domain Names**
  - you are given a sub domain name for main account owner: `yourAppName.azurewebsites.net`.
  - purchase domain from Azure portal, you don't have to configure anything.
  - `A` record: points to IP address.
  - `Cname`: maps domain to another domain name.
- **Backup and Restore App**
  - App snapshots can be created on a schedule or manually backup.
  - **Standard** or **Premium** tier App Service plan.
  - full or partial backups.
- **Application Insights**
  - continuously monitor the performance and usability of your apps.
  - analytic tools(failure, response, request, views, load performance) to understand what users are doing with your apps.
  - Apps hosted on-premises, in a hybrid environment, or in any public cloud.
  - ![application insights](img/application_insights.PNG)

## Azure Containers

- **Containers**
  - isolated containers(like docker) instances.
  - **persistent storage**: **Azure Disk**, or **Azure files**(SMB) for multiple nodes to share.
  - **weak security** boundary, but **high fault tolerance**(new node will be created if one fails.)
  - **flexibility and speed**: **OS is shared(only run needed services)** and use less resources. sharing, testing, deployment easier.
- **Azure Container Instance (ACI)**
  - preferred way to package, deploy and manage cloud apps. ACI provide a simple way to create container instances without having to create and manage a VM.
  - **billed only for containers in use**.
  - ![container instance](img/container-instance.PNG)
- **Container Group**
  - collection of containers that get scheduled on the same host machine. The containers in a container group **share** a **lifecycle, resources, local network, and storage volumes**.
  - same as 'pod' in Kubernetes(multiple containers per pod).
  - deploy through ARM(Azure Resource Manager) or YAML files.
- **Azure Container Apps**
  - serverless platform that **simplifies deployment**. maintain less infrastructure to run/manage containerized apps.
  - Container Apps provides resources: server configuration, container orchestration, and deployment details, so you don't have to.

## Azure Powershell and CLI

- **CLI**
  - <https://learn.microsoft.com/en-us/cli/azure/reference-index?view=azure-cli-latest>

```sh
# Show list of all available images
az vm image list --output table
az vm image list --sku Wordpress --output table --all # wordpress images
az vm image list --publisher Microsoft --output table --all # microsoft images
# available datacenter locations
az vm image list --location eastus --output table
# VM sizes
az vm list-sizes --location eastus --output table
# Resize VM
az vm list-vm-resize-options --resource-group "[sandbox resource group name]" --name SampleVM --output table
az vm resize --resource-group "[sandbox resource group name]" --name SampleVM --size Standard_D2s_v3
# Query
az vm show --resource-group "group name" --name SampleVM --query "networkProfile.networkInterfaces[].id"
# VMs
# Create
az vm create --resource-group "[sandbox resource group name]" --location westus --name SampleVM --image Ubuntu2204 --admin-username azureuser --generate-ssh-keys --verbose
# When creating multiple VMs, Adding '--no-wait' will cause 'azure VM create' to return immediately without waiting for VM creation.
# View all VMs -return all virtual machines defined in this subscription.
az vm list --output table
# Show VM specs
az vm show --resource-group "[sandbox resource group name]" --name SampleVM
# VM IP address
az vm list-ip-addresses -n SampleVM -o table

# Network
az vm open-port --port 80 --resource-group "[sandbox resource group name]" --name SampleVM # open port 80
# VNET
az network vnet create --resource-group "[sandbox resource group name]" --name CoreServicesVnet --address-prefixes 10.20.0.0/16 --location westus
# Subnet
az network vnet subnet create --resource-group "[sandbox resource group name]" --vnet-name CoreServicesVnet --name GatewaySubnet --address-prefixes 10.20.0.0/27
```

## Azure Networks and Network Security Groups

- **Application Gateway**
  - layer 7 load balancer(for web traffic(HTTP(S))) and firewall(optional). directs traffic to backend pools(resources) via **Round-Robin** method.
  - **Basic**: routing via **URL**(includes hostname and port).
  - **Multi-site routing**: multiple different web app routing(based on Domain Name) on same Application Gateway.
  - allows redirects, HTTP header rewrite.
  - ![application gateway](img/application_gateway.PNG)
  - ![application gateway](img/application_gateway2.PNG)
- **Application Security Group**
  - grouping VMs based on application(function). e.g. web server and database.
  - layer 3 and 4(IP and port).
- **Azure DNS**
  - acts as the SOA for domain name. manage and host your **registered** domain.
  - after creating **Azure DNS zone**, go to your DNS registrar, point DNS server to Azure DNS zone.
    - `nslookup -type=SOA example.com`
    - **DNS**: Domain Name Server. maps domain name with IP.
    - **SOA**: start of authority. master record for domain.
    - **A**: maps domain to IPv4.
    - **AAAA** map domain to IPv6.
    - **CNAME**: Canonical Name. alias pointing to domain.
    - **MX**: mail exchange. email server IP.
    - **TXT**: text record. associate text strings with domain. e.g. DKIM...
  - **private DNS zone**: not visible on internet. only available to your local network. assign name to VNET IP.
  - **Apex Domain**: highest level domain. sometimes called _zone apex_ or _root apex_. `example.com` // `.com` is Top Level Domain (TLD).
    - designated by `@`
- **ExpressRoute**
  - connect private on-prem connection with Azure VNET. Dedicated line from connectivity provider. traffic does not traverse public internet. higher security.
- **Load Balancer**
  - high availability. scale. **inbound** or **outbound traffic**. **public** or **internal** facing.
  - **internal** load balancer must be in same VNET as VMs and **do not** have a **public IP**.
  - can use **availability sets**(hardware failure) and **availability zones**(datacenter failure) to ensure that virtual machines are always available.
  - **Types**:
    - **Basic**: original, superseded by standard.
    - **Standard**: up to 1,000 pools.
    - **Gateway**: high performance and high availability.
  - **To implement a load balancer**:
    - **Front-end IP configuration**: ip load balancer assigned.
    - **Back-end pools**: resources (VNET and IP) waiting for traffic.
    - **Health probes**: checks backend resources health.
    - **Load-balancing rules**: how to distribute the requests to the back-end.
    - **Distribution Mode**: default (NAT table traffic distribution type) **five-tuple hash**(source IP address, source port, destination IP address, destination port, and protocol type(TCP, UDP)).
    - **Source IP Affinity**: source IP -> destination IP. when using Remote Desktop Gateway(RDP) for windows or media upload, you cannot use five-tuple hash. you must use source IP affinity as your distribution mode.
      - **Session Persistence**: group same client request or send to any VM listening.
- **Network Interface Card (NIC)**
  - vNIC. layer 2.
  - can have network security group applied.
- **Network Security Group (NSGs)**
  - enforce and control network traffic rules at the networking level.
  - software firewall by filtering **inbound and outbound traffic**(subnet or network interface(NIC)) with **allow/deny rules**.
  - The last rule is always a **Deny All** rule.
  - can be applied to **subnets** and **NIC**.
  - **Rules**
    - default: **deny** all **inbound(except loadBalancer or VNET subnets)**. **allow** all **outbound**.
    - without NSG, **all** traffic is allowed.
    - rules can be overridden by **Priority** value.
      - **priority values**: 100 - 4096. processed from low to high. first rule matches, processing stops. lower numbers are processed first, so have higher priority.
    - default **intra-subnet** traffic(resources inside same subnet) are **allowed**.
    - you must define an **allow rule** for both the **subnet and network interface** in the group to ensure traffic can get through.
    - because a NIC or subnet can each have a security group:
      - inbound: the subnet(NSG 1) rules will take precedence.
      - outbound: the NIC(NSG 2) will take precedence.
      - ![nsg rules](img/nsg.PNG)
- **Peering**
  - seamless connection of two or more VNETs. function as single VNET.
  - managed as separate resources, but communicate as single resource.
  - Traffic between the virtual networks is kept on the **Microsoft Azure backbone** network. No public IP, gateways, or encryption is required in the communication between the virtual networks.
  - allow remote communication between peering VNETs with VPN Gateway.
  - **Transitivity**: must be explicit. Only VNETs that are directly peered can communicate with each other. e.g. A,B,C VNET. Peer A->B and B->C. A->C does not automatically work without explicit peering A->C.
  - can peer if different Microsoft Tenants, subscriptions... To peer, administrator must have the **_Network Contributor_** role on their virtual network.
  - **Regional and Global Peering**
    - **Regional**: VNETs in same region.
    - **Global**: VNETS in different regions. Any Azure cloud region, China cloud region, but not Government Region.
    - ![peering global](img/peering_global.PNG)
  - **Gateway Transit**: allows peered networks to share same **VPN Gateway**.
  - **Extend Peering**
    - Hub and Spoke: Traffic can flow through NVAs or VPN gateways in the hub virtual network.
      - ![hub and spoke peering](img/peering_hub_and_spoke.PNG)
    - User-defined routes(UDR): manually define route to VPN Gateway.
    - **Service Chaining**: with UDR, direct traffic from VNET to VPN Gateway. VNETs must be peered.
  - **PowerShell and CLI Peering**
    - creating peering from **PowerShell** or **CLI**, you must create peering from **A->B and B->A**.
    - Azure portal automatically creates both.
- **Network Virtual Appliance (NVA)**
  - software virtual machine with the same functionality. e.g. **Cisco Firewall** can be used as a gateway to public internet.
  - from providers in **Azure Marketplace**.
- **Point-to-Site (P2S)**
  - VPN tunnel from individual computer. no public IP address. Connects to 'VPN Gateway' on the Azure side.
- **Private Link**
  - Traffic between your VNET and the service travels the Microsoft backbone network. eliminates data exposure to the public internet.
  - ![private link](img/private_link.PNG)
  - ![private link](img/private_link2.PNG)
- **Routes**
  - custom routes direct traffic flow within VNET. all routes are stored in the **_route table_**.
  - **Service Tags**: can be used as a route address in a user-defined route(UDR).
  - **Border Gateway Protocol (BGP)**: routing protocol for on-prem to Azure VNET. can create site-to-site connection.
  - **Specificity**: most direct match wins. e.g. 10.0.0.6 with route 10.0.0.0/16 and 10.0.0.0/24. the 10.0.0.0/24 is more specific and will be chosen.
    - **Order of specificity**: user-defined, BGP route, system route.
  - **System Routes**:
    - Azure uses **_system routes_** to direct traffic between VMs, on-prem and internet. system routes enable communication between any VM and any other VM in VNET.
    - uses **_route table_**(rules of how to get to destination) to store system routes.
    - You **can't create or delete system routes**, but you can **override** the system routes by adding custom routes to control traffic flow to the **next hop**.
    - Every **subnet** has the following **default system routes**:
      - **Virtual Network**: address prefix. range inside VNET.
      - **Internet**: default route to internet.
      - **None**: drops traffic.
      - ![subnet default route](img/subnet_default_route.PNG)
- **Service Endpoints**
  - **service endpoint**: allow **all** instances in a subnet(your VNET) to communicate to another Azure service over the Microsoft backbone. no public internet access.
  - **private endpoint**: **single** instances in a subnet(your VNET) to communicate to another Azure service over the Microsoft backbone. no public internet access.
  - ![service endpoint](img/service_endpoint.PNG)
- **Site-to-site VPNs (S2S)**
  - use IPSEC to provide a secure connection between your **corporate VPN Gateway** and **Azure**.
- **Subnets and Screened Subnets (DMZ) and IP Addresses**
  - network can be segmented into subnets to help improve security, increase performance, and make it easier to manage.
  - default **all subnets** in VNET **can communicate** with each other.
  - subnet must be specified by using **CIDR** notation.
    - each subnet, the **first four addresses** and the **last address** are **reserved**.
    - smallest supported subnet: **/29** subnet mask(8 IP addresses), largest supported subnet: **/2** subnet mask(1,073,741,824 IP addresses).
  - segmenting networks allows custom firewall rules for each subnet.
  - **maximum one security group per subnet**.
  - **Screened Subnet (DMZ)**
    - security group applied to a subnet acts as buffer between resource and internet.
    - restrict traffic flow.
  - **Azure IP Addresses Schema**
    - **private IP**: internal communication only. on-prem communication, use VPN Gateway or ExpressRoute.
    - **public IP**: communicate with resources over the public internet.
      - **basic**: (static/dynamic) assigned. inbound traffic.
      - **standard**: static only. NSG default rules. add routing rules
    - **static IP**: does not change. best for DNS records, TLS certs, Firewall rules based on IP range.
    - **dynamic IP**: changes as needed. typically change when VM/service is stopped and restarted.
    - **Schema**
      - IP Address range with on-prem can't overlap cloud. e.g. on-prem: 192.168.0.0/16(65,536) and cloud 192.168.10.0/24(256). // on-prem includes the 192.168.10.0 network.
    - **Public IP Prefix**: Azure **region specific** range of **contiguous** static IP addresses. **prefix size** is the number of IP addresses.
    - **Private IP Addresses**: 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16
      - `.1, .2, .3 and last`, IP addresses aren't visible or configurable. Reserved for Load Balancers, Application Gateway, VM NICs.
  - **Route Table**
    - can have many subnets, each subnet only one route table.
- **Traffic Manager Profile**
- **Virtual Network Gateway**
  - encrypt traffic from on-prem(physical device) to Azure VNET over the internet.
  - **Virtual Network Gateway**: Azure Gateway Service.
  - **Local Network Gateway**: the on-prem device.
- **Virtual WAN**
- **VNET**
  - VPN network. provide logical isolation and protection. IP range once chosen, cannot be changed.
  - If **no security group** is applied, then **all** traffic is **allowed** by Azure.
  - Azure blocks SMTP (Email port 25) outbound.
  - link virtual networks with an on-premises IT infrastructure to create hybrid or cross-premises solution.
- **VPN Gateway**
  - Azure service that allows you to securely encrypt traffic between VPN and on-prem(site-to-site), or point-to-site(P2S) using IPSEC encrypted communications.
  - must have dedicated subnet for VPN Gateway.
  - VNET can only have **one** VPN Gateway.
  - ![vpn gateway](img/vpn_gateway.PNG)

## Azure Monitor

- **Azure Monitor**
  - **collects, analyzes**, and **responds** to **telemetry data** from both **on-prem**() and **cloud** environments.
  - charts to visualize metrics. view health and availability.
  - gather monitoring and diagnostic information about the health of your services. You can use this information to visualize and analyze the causes of problems that might occur in your app.
  - query and analyze logs.
  - alerts and actions: critical conditions notify you.
  - **Extend functionality**: adding **Azure Monitor Agent** to compute resources. Collects data on VM internal operations.
  - **Enable Diagnostics**: Azure SQL database will send full information to Azure Monitor when you **enable diagnostic logging**.
  - Azure Monitor has two main monitoring features: **Azure Monitor Metrics** and **Azure Monitor Logs**.
  - **Data Stores**
    - hold metrics and logs. **Azure Monitor Metrics** and **Azure Monitor Logs** are the two base types of data used by the service.
  - ![azure monitor](img/azure_monitor.PNG)
- **Activity Log**
  - who, what, when, where. subscription level events. any write operation (PUT, POST, DELETE) performed on resources in your subscription.
  - kept for **90 days**.
  - What operations happened on resources in my subscription?
  - Who initiated the operations?
  - When did the operations occur?
  - What's the current status of the operations?
  - What are the values of other properties that can help with my analysis of the resources and operations?
- **Alerts**
  - you configure alerts on key resources and who will get them.
  - data can be a **_metric_** or **_log_** or both.
  - **Metric**: numeric threshold is reached. ideally suited to monitoring for threshold breaches or spotting trends.
  - **Activity Logs**: when resource changes state(when specific changes occur on a resource within your Azure subscription).
  - **Logs**: based on what is written to log file.
    - they are stateless(alert even when already alerted on same rule if event happens again).
    - monitoring of historical data.
    - e.g. web server returns 404 or 500.
  - **Composition of an Alert**
    - **Resource**: the resource being monitored.
    - **Condition**: numeric(metric) or log file.
    - **Actions**: how and who gets alerted.
      - **severity**: 0(critical), 1(error), 2(warning), 3(informational), 4(verbose).
  - **dimensions**: can monitor multiple target instances at a time. use `*` as wildcard.
    - **scale**: when new resources are created, they would be included as well.
  - **Metric Alert Settings**
    - static or dynamic:
      - static: static is fixed value to measure against. e.g. 85% cpu usage.
      - dynamic: dynamic no fixed value. need three values:
        - metric: number you want to test.
        - look-back period: how many periods need evaluating.
        - number of violations: how many times there can be violation before alert.
    - how often to run. e.g. every two minutes.
    - data to be assessed. e.g. last 10 minutes.
  - **Log Alert Settings**
    - **Query**: query that runs every time alert rule fires.
    - **Time Period**: time range for query.
    - **Frequency**: how often should rule should run.
    - **Threshold**: when alert should notify someone.
    - **Aggregate function**: count the average.
    - **Group Field**: group results and alert only if pattern found.
  - **Alert Events**
    - **Specific Operation**: alert event contacts someone or creates an IT Service Management(ITSM) support ticket.
    - **Service Health Event**: notice of incidents or maintenance. You no longer need to select a resource, because alert is for whole region. you opt in to what alerts you want to receive.
  - **Action Groups**: what and how alert is sent. can be reused.
  - ![alerts](img/alerts.PNG)
- **Analyze (Log Analytics)**
  - **analytics** from your logs.
  - create and test queries. Use the query results to directly analyze the data, save your queries, visualize the data, and create alert rules.
  - uses a version of the **Data Explorer** query language. The language is suitable for simple log queries, but also includes advanced functionality like **aggregations**, **joins**, and **smart analytics**.
  - **Log Analytics Workspace**
    - captured logs and data is stored in a **Log Analytics workspace**. the workspace becomes the basic management environment for Azure Monitor Logs.
    - each workspace has a unique workspace ID and resource ID.
    - workspace **name** must be **unique** within your **resource group**.
  - **Kusto Query Language (KQL)**: query log files.
    - output can be saved and viewed in the Azure Portal or exported to Power BI, Excel, Log Analytics.
    - schedule jobs to run automatically.
    - set thresholds for alerts.
    - Kusto is case-sensitive.
    - `StormEvent | count` # returns number. each operator is separated with pipe command `|`.
    - ![kusto query language](img/log_analytic_queries.PNG)
- **Insights**
  - analysis, alerting, and streaming to external systems.
- **Integrate**
  - export log query **results**. build workflows to retrieve and copy logs to external location.
- **Metrics and Logs**
  - All data collected by Azure Monitor fits into one of two fundamental types, **metrics** and **logs**.
  - **Metrics**
    - numerical values that describe some aspect of a system at a particular point in time. can capture metrics in near-real time.
    - Metrics are stored in a **time-series database**.
    - **can store only numeric(metric) data**
    - Azure Monitor displays collected metrics on the **Overview** page.
    - resources performance data and amounts consumed, stored as metric.
  - **Logs**
    - contain time-stamped data about resources, organized into **records** with different sets of **properties** for each type.
    - logs are **stored as tables**.
    - **can store both metric(numeric) and event log data**.
    - begins collecting data as soon as you create your Azure subscription and add resources.
    - create or modify resources, stored in Azure Monitor activity logs.
    - **Azure Monitor Agent**: allows you to collect internal logs from **Windows/Linux** VMs.
    - **Data Collector API**: collect logs from any **REST API**.
    - **Azure Monitor Analyze**: query language for logs.
- **Network Watcher**
  - monitor, diagnose, and manage resources in an Azure virtual network.
  - reports that someone cannot access resources, network watcher helps you quickly identify(pin point root cause) the cause.
  - **IP flow verification**: check connectivity to internet.
    - checks security and admin rules for packet routing to an Azure virtual machine. sends different packets to check connectivity.
    - If test packet is denied, returns NSG rule that blocked packet.
    - failed test and no issue reported by IP flow, firewall could be issue.
  - **Next Hop Analysis**: helps verify network configuration. find broken routes.
    - is traffic delivered to intended destination?
    - returns next hop: type, ip, route table.
  - **Network Topology**: visual diagram of resource routes.
  - must be Owner, Contributor, or Network Contributor to use Network Watcher.
  - remote monitoring, alert notification, NSG flow and log analysis.
  - **IP Flow Verify**:
  - **Next Hop**:
  - **Network Topology**:
- **Tiers**
  - Tiers of monitoring data collect by Azure Monitor:
  - **Application**: performance and functionality of application code.
  - **Guest OS**: collects OS logs. VM, on-prem or another cloud.
  - **Azure Resource**: resource consumption by VMs, Services.
  - **Azure Subscription**: operation and management of Azure subscription. health of Azure itself.
  - **Azure Tenant**: tenant level services data. e.g. Entra ID
- **Visualize**
  - viewing and interpreting metrics and logs.
- **VM Monitoring**
  - to proactively prevent and quickly respond to any access, security, and performance issues, you need to monitor your VMs' traffic, health, performance, and events.
  - default basic metrics are collected from each VM and shown on the VMs **Overview** page.
  - **Metrics** can measure VM performance, resource utilization, error counts, user responses, or any other aspect of the system that you can quantify numerically.
    - default kept for 93 days.
  - **Logs** are records of system events that contain a timestamp and different types of structured or free-form data.
  - **Extend functionality**: adding **Azure Monitor Agent** to compute resources. Collects data on VM internal operations. on-prem or cloud VMs.
    - stores log data in a **Log Analytics workspace** for querying and analysis.
  - **Host Monitoring**
    - VM host represents compute, storage, and network.
  - **VM Alerts**: Recommended alert rules are a predefined set of alert rules based on commonly monitored host metrics.
  - **Boot Diagnostics**: linux/windows. show boot console log output. stores data in a managed storage account.
  - **Azure Monitor Agent**: program that collects **OS workloads**, guest OS... After install, you set up a **Data Collection Rule** (DCR).
    - **DCR**: defines what to collect and where to send data.
  - **VM Insights**: feature that installs **Azure Monitor Agent** and provides prebuilt **DCR** to help you get started monitoring **metrics**(usage and performance) on one or more VMs.
  - **VM Event Logs**: create custom DCR. specify data you want to collect and where to send. If sent to **Log Analytics workspace**, data can be analyzed with the **Kusto Query Language**(KQL).
  - **Data Collection Endpoint**: required with **Insights**. where to send data.
  - ![vm monitoring](img/VM_monitoring.PNG)
